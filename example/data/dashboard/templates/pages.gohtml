{{define "statsPage"}}
    <div class="content-wrapper">
        <div class="page-header">
            <h2>Live Statistics</h2>
            <button type="button" class="icon-only" id="refreshStatsBtn" title="Refresh">
                <svg class="btn-icon" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"
                     xmlns="http://www.w3.org/2000/svg">
                    <path d="M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8" stroke-linecap="round"
                          stroke-linejoin="round"></path>
                    <path d="M21 3v5h-5" stroke-linecap="round" stroke-linejoin="round"></path>
                </svg>
            </button>
        </div>
        <div class="top-grid">
            <div class="card stat-card"><h2>Total Hits</h2>
                <p id="total-hits">0</p></div>
            <div class="card stat-card"><h2>Unique IPs</h2>
                <p id="unique-ips">0</p></div>
            <div class="card stat-card"><h2>Unique Agents</h2>
                <p id="unique-agents">0</p></div>
            <div class="card" id="application-info-card">
                <div class="card-header"><h3>Application Info</h3></div>
                <div class="card-content">
                    <ul class="vitals-list" id="application-info-list"></ul>
                </div>
            </div>
        </div>

        <div class="card table-container">
            <div class="card-header">
                <h3>IP Address Analysis</h3>
                <div class="card-header-actions">
                    <input type="text" class="table-search-input" placeholder="Filter IPs..." data-table="ips">
                    <button type="button" class="secondary show-all-btn" data-table="ips">Show Top 5</button>
                </div>
            </div>
            <table id="ips-table" class="responsive-table">
                <thead>
                <tr>
                    <th class="sortable" data-sort="last_seen">Status</th>
                    <th class="sortable" data-sort="ip_address">IP Address</th>
                    <th class="sortable text-right" data-sort="total_hits">Hits</th>
                    <th class="sortable text-right" data-sort="hit_rate">Hit Rate</th>
                    <th class="sortable" data-sort="last_seen">Last Seen</th>
                </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>

        <div class="card table-container" style="margin-top: 1.5rem;">
            <div class="card-header">
                <h3>User Agent Analysis</h3>
                <div class="card-header-actions">
                    <input type="text" class="table-search-input" placeholder="Filter User Agents..."
                           data-table="agents">
                    <button type="button" class="secondary show-all-btn" data-table="agents">Show Top 5</button>
                </div>
            </div>
            <table id="agents-table" class="responsive-table">
                <thead>
                <tr>
                    <th class="sortable" data-sort="last_seen">Status</th>
                    <th class="sortable" data-sort="user_agent">User Agent</th>
                    <th class="sortable text-right" data-sort="total_hits">Hits</th>
                    <th class="sortable text-right" data-sort="hit_rate">Hit Rate</th>
                    <th class="sortable" data-sort="last_seen">Last Seen</th>
                </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>
{{end}}

{{define "whitelistPage"}}
    <div class="content-wrapper" style="max-width: 900px;">
        <div class="page-header">
            <h2>Manage Whitelists</h2>
            <button class="icon-only" id="refreshWhitelistBtn" title="Refresh" type="button">
                <svg class="btn-icon" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"
                     xmlns="http://www.w3.org/2000/svg">
                    <path d="M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8" stroke-linecap="round"
                          stroke-linejoin="round"></path>
                    <path d="M21 3v5h-5" stroke-linecap="round" stroke-linejoin="round"></path>
                </svg>
            </button>
        </div>
        <p class="page-description">
            Whitelisted clients bypass the tarpit and receive a standard 404 Not Found response. Use exact matching for
            IP addresses and User Agents.
        </p>
        <div class="card">
            <div class="card-content">
                <div class="tab-nav" id="whitelist-tab-nav">
                    <button class="tab-btn active" data-type="ip">IP Addresses</button>
                    <button class="tab-btn" data-type="useragent">User Agents</button>
                </div>
                <div id="ip-panel" class="tab-panel active">
                    <form class="add-whitelist-form" id="add-ip-whitelist-form" data-scope="whitelist:write">
                        <input id="addIpValue" placeholder="e.g., 1.2.3.4" required>
                        <button type="submit">Add IP</button>
                        <button type="button" class="secondary import-whitelist-btn" data-type="ip">Import .txt</button>
                    </form>
                    <ul class="whitelist-list" id="ip-whitelist-list"></ul>
                </div>
                <div id="useragent-panel" class="tab-panel">
                    <form class="add-whitelist-form" id="add-useragent-whitelist-form" data-scope="whitelist:write">
                        <input id="addUserAgentValue" placeholder="e.g., Googlebot/2.1" required>
                        <button type="submit">Add User Agent</button>
                        <button type="button" class="secondary import-whitelist-btn" data-type="useragent">Import .txt
                        </button>
                    </form>
                    <ul class="whitelist-list" id="useragent-whitelist-list"></ul>
                </div>
            </div>
        </div>
    </div>
{{end}}

{{define "templatesPage"}}
    <div class="content-wrapper">
        <div class="grid template-grid">
            <div class="card">
                <div class="card-header">
                    <h3>Manage Templates</h3>
                    <button class="icon-only" id="refreshTemplateListBtn" title="Refresh" type="button">
                        <svg class="btn-icon" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg">
                            <path d="M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8" stroke-linecap="round"
                                  stroke-linejoin="round"></path>
                            <path d="M21 3v5h-5" stroke-linecap="round" stroke-linejoin="round"></path>
                        </svg>
                    </button>
                </div>
                <div class="card-content">
                    <label for="templateSelector">Select or Create Template</label>
                    <select id="templateSelector" style="margin-bottom: 1rem;">
                        <option>-- Load Templates --</option>
                    </select>

                    <div id="create-template-form" class="hidden-view">
                        <form id="createTemplateFormInternal" data-scope="templates:write">
                            <label for="newTemplateNameInput">New Template Base Name</label>
                            <input id="newTemplateNameInput" placeholder="my-new-page" required
                                   style="margin-bottom: 0.5rem;">
                            <label for="template-extension" style="margin-bottom: 0.5rem;">Template Type</label>
                            <div class="extension-chooser">
                                <label><input type="radio" name="template-extension" value=".tmpl.html" checked> Full
                                    Template <span class="ext-mono">(.tmpl.html)</span></label>
                                <label><input type="radio" name="template-extension" value=".part.html"> Partial <span
                                            class="ext-mono">(.part.html)</span></label>
                            </div>
                            <small class="helper-text">Use Partials for reusable components like headers or
                                footers.</small>
                            <label for="newTemplateContent">Initial Content</label>
                            <textarea id="newTemplateContent"></textarea>
                            <button type="submit">Create Template</button>
                        </form>
                        <div class="template-actions" style="margin-top:1rem;">
                            <button type="button" id="testNewTemplateBtn" disabled>Test Unsaved</button>
                        </div>
                    </div>

                    <div id="edit-template-actions" class="hidden-view">
                        <form id="templateEditForm" data-scope="templates:write"
                              style="display:flex; flex-direction:column; flex-grow:1;">
                            <label for="templateContent">Template Content</label>
                            <textarea id="templateContent"></textarea>
                            <div class="template-actions">
                                <button type="submit">Save Changes</button>
                                <button id="testTemplateBtn" type="button">Test Unsaved</button>
                            </div>
                        </form>
                        <hr data-scope="templates:write">
                        <button type="button" class="danger" id="deleteTemplateBtn" data-scope="templates:write">Delete
                            Selected Template
                        </button>
                    </div>
                </div>
            </div>
            <div class="card hidden-view" id="template-preview-card">
                <div class="card-header">
                    <h3>Template Preview</h3>
                    <button type="button" class="icon-only" id="openPreviewNewTabBtn" title="Open in New Tab" disabled>
                        <svg class="btn-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                             stroke-width="1.5" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round"
                                  d="M13.5 6H5.25A2.25 2.25 0 0 0 3 8.25v10.5A2.25 2.25 0 0 0 5.25 21h10.5A2.25 2.25 0 0 0 18 18.75V10.5m-4.5 4.5V6H18"/>
                        </svg>
                    </button>
                </div>
                <div class="card-content">
                    <iframe id="template-preview-frame"></iframe>
                    <div class="preview-controls">
                        <label for="previewThreat">Threat Level:</label>
                        <input type="range" id="previewThreat" min="0" max="1000" value="1" style="flex-grow: 1;">
                        <span id="previewThreatValue" style="width: 4ch; text-align: right;">1</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
{{end}}


{{define "markovPage"}}
    <div class="content-wrapper">
        <div class="grid">
            <div class="card">
                <div class="card-header">
                    <h3>Manage Models</h3>
                    <div id="training-status-indicator" class="status-indicator-hidden">
                        <div class="spinner" style="width: 1em; height: 1em; border-width: 2px;"></div>
                        <span>Training...</span>
                    </div>
                    <button class="icon-only" id="refreshModelListBtn" title="Refresh" type="button">
                        <svg class="btn-icon" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg">
                            <path d="M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8" stroke-linecap="round"
                                  stroke-linejoin="round"></path>
                            <path d="M21 3v5h-5" stroke-linecap="round" stroke-linejoin="round"></path>
                        </svg>
                    </button>
                </div>
                <div class="card-content">
                    <label for="modelSelector">Select or Create Model</label>
                    <select id="modelSelector" style="margin-bottom: 1rem;">
                        <option>-- Load Models --</option>
                    </select>

                    <div id="create-model-form" class="hidden-view" data-scope="markov:write">
                        <form id="createModelFormInternal">
                            <h4>Create New Model</h4>
                            <label for="createModelName">New Model Name</label>
                            <input id="createModelName" placeholder="e.g., tech-docs" required>
                            <label for="createModelOrder">Model Order</label>
                            <input type="number" id="createModelOrder" value="2" required>
                            <button type="submit">Create Model</button>
                        </form>
                    </div>

                    <div id="existing-model-actions" class="hidden-view">
                        <form id="trainModelForm" data-scope="markov:write">
                            <label for="trainCorpusFile">Train with Corpus File (.txt)</label>
                            <input type="file" id="trainCorpusFile" accept=".txt" required>
                            <button type="submit">Train Selected Model</button>
                            <div class="form-status" id="trainModelStatus"></div>
                        </form>
                        <hr data-scope="markov:write">
                        <form id="pruneModelForm" data-scope="markov:write">
                            <label for="pruneMinFreq">Prune with Min Frequency</label>
                            <input type="number" id="pruneMinFreq" value="1" required>
                            <button type="submit">Prune Selected Model</button>
                        </form>
                        <hr>
                        <div style="display: flex; flex-direction: column; gap: 1rem;">
                            <button id="exportModelBtn" type="button">Export Selected Model</button>
                            <button class="danger" id="deleteModelBtn" type="button" data-scope="markov:write">Delete
                                Selected Model
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="card hidden-view" id="model-testing-card" data-scope="markov:read">
                <div class="card-header">
                    <h3>Test Generation</h3>
                </div>
                <div class="card-content">
                    <form id="generateTextForm">
                        <label for="generateStartText">Starting Text (Optional)</label>
                        <input id="generateStartText" placeholder="e.g., once upon a time">

                        <div class="grid" style="grid-template-columns: repeat(3, 1fr); margin-top: 1rem;">
                            <div>
                                <label for="generateMaxLength">Max Length</label>
                                <input type="number" id="generateMaxLength" value="50" min="1" max="500">
                            </div>
                            <div>
                                <label for="generateTemp">Temperature</label>
                                <input type="number" id="generateTemp" value="0.8" min="0" max="2" step="0.1">
                            </div>
                            <div>
                                <label for="generateTopK">Top-K</label>
                                <input type="number" id="generateTopK" value="0" min="0" max="100">
                            </div>
                        </div>

                        <button type="submit" style="margin-top: 1rem;">Generate</button>
                    </form>
                    <hr>
                    <label for="generateResult">Generated Text</label>
                    <textarea id="generateResult" readonly
                              placeholder="Generation results will appear here..."></textarea>
                </div>
            </div>
            <div class="card" data-scope="markov:write">
                <div class="card-header"><h3>Global Actions</h3></div>
                <div class="card-content">
                    <form id="importModelForm">
                        <label for="importModelFile">Import Model from File (.json)</label>
                        <input type="file" id="importModelFile" accept=".json" required>
                        <button type="submit">Import Model</button>
                    </form>
                    <hr>
                    <form id="pruneVocabForm">
                        <label for="pruneVocabMinFreq">Prune Global Vocabulary</label>
                        <input type="number" id="pruneVocabMinFreq" value="2" required>
                        <button type="submit">Prune Vocabulary</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
{{end}}

{{define "authPage"}}
    <div class="content-wrapper">
        <div class="grid">
            <div class="card table-container">
                <div class="card-header">
                    <h3>Existing API Keys</h3>
                    <button class="icon-only" id="refreshKeysListBtn" title="Refresh" type="button">
                        <svg class="btn-icon" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg">
                            <path d="M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8" stroke-linecap="round"
                                  stroke-linejoin="round"></path>
                            <path d="M21 3v5h-5" stroke-linecap="round" stroke-linejoin="round"></path>
                        </svg>
                    </button>
                </div>
                <table id="keys-table" style="width:100%;" class="responsive-table">
                    <thead>
                    <tr>
                        <th>ID</th>
                        <th>Description</th>
                        <th>Scopes</th>
                        <th>Actions</th>
                    </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
            <div class="card">
                <div class="card-header"><h3>Create New Key</h3></div>
                <div class="card-content">
                    <form id="createKeyForm">
                        <label for="createKeyDesc">Description</label>
                        <input id="createKeyDesc" required>
                        <div class="label-with-helpers">
                            <label>Scopes</label>
                            <div class="scope-helpers">
                                <a id="selectAllScopes">Select All</a>
                                <a id="deselectAllScopes">Deselect All</a>
                            </div>
                        </div>
                        <div id="scopes-container"></div>
                        <button type="submit">Create Key</button>
                    </form>
                    <div id="key-created-result">
                        <strong>Key Created! Copy it now, it will not be shown again.</strong>
                        <div class="key-display">
                            <input id="newKeyValue" readonly>
                            <button id="copyKeyBtn" type="button">Copy</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{{end}}

{{define "serverPage"}}
    <div class="content-wrapper">
        <div class="page-header">
            <h2>Application Configuration</h2>
            <button type="button" id="configEditorToggleBtn">Switch to Raw JSON</button>
        </div>

        <form id="updateSimpleConfigForm">
            <div id="simple-config-editor-view">
                <div class="config-column-wrapper">
                    <div class="card">
                        <div class="card-header"><h3>Server Config</h3></div>
                        <div class="card-content">
                            <div id="server_config-editor"></div>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-header"><h3>Save Changes</h3></div>
                        <div class="card-content">
                            <p class="page-description">Changes saved here will overwrite `config.json` on disk. Some
                                changes may require a server restart to take effect.</p>
                            <button style="width:100%;" type="submit">Save & Apply Configuration</button>
                        </div>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header"><h3>Template Config</h3></div>
                    <div class="card-content">
                        <div id="template_config-editor"></div>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header"><h3>Threat Config</h3></div>
                    <div class="card-content">
                        <div id="threat_config-editor"></div>
                    </div>
                </div>
            </div>
        </form>

        <div id="raw-config-editor-view" class="hidden-view">
            <div class="card" style="flex-grow:1;">
                <div class="card-content" style="display:flex; flex-direction:column; flex-grow:1;">
                    <form id="updateRawConfigForm" style="display:flex; flex-direction:column; flex-grow:1;">
                        <textarea id="appConfigText" required style="min-height: 500px;"></textarea>
                        <button id="updateConfigBtn" type="submit">Update & Save Config</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
{{end}}

{{define "applicationPage"}}
    <div class="content-wrapper" style="max-width: 800px;">
        <div class="card danger-card">
            <div class="card-header">
                <h3>
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                         stroke="currentColor" style="width:24px; height:24px;">
                        <path stroke-linecap="round" stroke-linejoin="round"
                              d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z"/>
                    </svg>
                    Danger Zone
                </h3>
            </div>
            <div class="card-content" style="display:flex; flex-direction:column; gap: 1.5rem;">
                <div class="danger-zone-action">
                    <h4>Restart Server</h4>
                    <p class="page-description">This will gracefully restart the Sarracenia server process, reloading
                        the configuration from disk.</p>
                    <button type="button" class="warning" id="restartBtn">Restart Server</button>
                </div>
                <hr>
                <div class="danger-zone-action">
                    <h4>Shutdown Server</h4>
                    <p class="page-description">This will gracefully shut down the server process. It must be restarted
                        manually from the command line or service manager.</p>
                    <button type="button" class="danger" id="shutdownBtn">Shutdown Server</button>
                </div>
                <hr>
                <div class="danger-zone-action">
                    <h4>Reset All Statistics</h4>
                    <p class="page-description">This will permanently delete all collected IP and User Agent statistics
                        from the database. This action cannot be undone.</p>
                    <button type="button" class="danger" id="resetStatsBtn">Reset All Statistics</button>
                </div>
            </div>
        </div>
    </div>
{{end}}

{{define "themesPage"}}
    <div class="content-wrapper">
        <div class="page-header">
            <h2>Themes</h2>
        </div>

        <div class="tab-nav" id="themes-tab-nav">
            <button class="tab-btn active" data-target-panel="themes-list-panel">Themes</button>
            <button class="tab-btn" data-target-panel="theme-editor-panel">Theme Editor</button>
        </div>

        <div id="themes-list-panel" class="tab-panel active">
            <div style="margin-bottom: 2rem;">
                <h3 style="margin-bottom: 1rem; color: var(--text-secondary); font-size: 1rem; text-transform: uppercase; letter-spacing: 0.05em;">
                    My Saved Themes</h3>
                <div class="grid theme-grid" id="saved-themes-grid">
                    <p class="list-empty-state" style="grid-column: 1/-1; text-align: left; padding: 0;">No custom
                        themes saved yet.</p>
                </div>
            </div>

            <div>
                <h3 style="margin-bottom: 1rem; color: var(--text-secondary); font-size: 1rem; text-transform: uppercase; letter-spacing: 0.05em;">
                    Preset Themes</h3>
                <div class="grid theme-grid" id="preset-themes-grid">
                    <!-- Theme cards will be rendered here by JS -->
                    <div class="skeleton" style="height: 150px;"></div>
                    <div class="skeleton" style="height: 150px;"></div>
                    <div class="skeleton" style="height: 150px;"></div>
                    <div class="skeleton" style="height: 150px;"></div>
                </div>
            </div>
        </div>

        <div id="theme-editor-panel" class="tab-panel">
            <div class="grid" style="grid-template-columns: 2fr 1fr; align-items: start;">
                <div class="card">
                    <div class="card-header">
                        <h3>Editor</h3>
                        <div class="card-header-actions">
                            <button class="secondary" id="importThemeBtn" title="Import from Clipboard">Import</button>
                            <button class="secondary" id="exportThemeBtn" title="Copy JSON to Clipboard">Copy JSON
                            </button>
                        </div>
                    </div>
                    <div class="card-content">
                        <div style="display: flex; gap: 1rem; margin-bottom: 1.5rem; align-items: flex-end;">
                            <div style="flex-grow: 1;">
                                <label for="customThemeName">Theme Name</label>
                                <input type="text" id="customThemeName" placeholder="e.g., My Cool Dark Theme">
                            </div>
                            <button id="saveCustomThemeBtn" style="margin-bottom: 1px;">Save Theme</button>
                        </div>

                        <div id="custom-theme-editor-grid"
                             style="display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 1.5rem;">
                            <!-- Populated by JS -->
                        </div>
                        <hr>
                        <button id="applyEditorThemeBtn" class="secondary" style="width: 100%;">Apply Changes
                            (Preview)
                        </button>
                    </div>
                </div>
                <div class="card sticky-card" style="position: sticky; top: 100px;">
                    <div class="card-header"><h3>Live Preview</h3></div>
                    <div class="card-content">
                        <!-- A mini mockup of the dashboard components -->
                        <div class="mockup-container"
                             style="display: flex; flex-direction: column; gap: 1rem; border: 1px solid var(--border-color); padding: 1rem; border-radius: 8px; background: var(--bg-main);">
                            <div style="background: var(--bg-surface); padding: 1rem; border-radius: 8px; border: 1px solid var(--border-color);">
                                <h4 style="color: var(--text-primary); margin: 0 0 0.5rem 0;">Card Title</h4>
                                <p style="color: var(--text-secondary); margin: 0;">Secondary text example.</p>
                                <button style="margin-top: 1rem;">Primary Button</button>
                                <button class="danger" style="margin-top: 0.5rem;">Danger Button</button>
                                <button class="warning" style="margin-top: 0.5rem;">Warning Button</button>
                            </div>
                            <div style="color: var(--text-accent);">Accent Link Text</div>
                            <input type="text" placeholder="Input field..." style="width: 100%;">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{{end}}